From 6197057a0220a6768843d17ddcee53b56209ad4c Mon Sep 17 00:00:00 2001
From: Martin Jansa <martin.jansa@gmail.com>
Date: Fri, 20 Oct 2023 23:19:53 +0000
Subject: [PATCH] test/test_corners.cpp: fix -Werror=maybe-uninitialized

FAILED: test/CMakeFiles/test_corners.dir/test_corners.cpp.o
/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot-native/usr/bin/x86_64-webos-linux/x86_64-webos-linux-g++ --sysroot=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot  -I/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/git/include -isystem /OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot/usr/src/gtest/include -isystem /OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot/usr/src/gtest -m64 -march=nehalem -mtune=generic -mfpmath=sse -msse4.2  --sysroot=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot  -O2 -pipe -g -feliminate-unused-debug-types -fcanon-prefix-map  -fmacro-prefix-map=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/git=/usr/src/debug/leveldb-tl/1.0.6+git-r0  -fdebug-prefix-map=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/git=/usr/src/debug/leveldb-tl/1.0.6+git-r0  -fmacro-prefix-map=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/build=/usr/src/debug/leveldb-tl/1.0.6+git-r0  -fdebug-prefix-map=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/build=/usr/src/debug/leveldb-tl/1.0.6+git-r0  -fdebug-prefix-map=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot=  -fmacro-prefix-map=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot=  -fdebug-prefix-map=/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot-native=  -fvisibility-inlines-hidden -std=c++14 -Wall -Wextra -Wconversion -Werror -fno-exceptions -fno-rtti -pthread -MD -MT test/CMakeFiles/test_corners.dir/test_corners.cpp.o -MF test/CMakeFiles/test_corners.dir/test_corners.cpp.o.d -o test/CMakeFiles/test_corners.dir/test_corners.cpp.o -c /OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/git/test/test_corners.cpp
In file included from /OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/git/test/test_corners.cpp:26:
In function 'testing::AssertionResult testing::internal::CmpHelperEQ(const char*, const char*, const T1&, const T2&) [with T1 = long unsigned int; T2 = unsigned char]',
    inlined from 'static testing::AssertionResult testing::internal::EqHelper::Compare(const char*, const char*, const T1&, const T2&) [with T1 = long unsigned int; T2 = unsigned char; typename std::enable_if<((! std::is_integral<_Tp>::value) || (! std::is_pointer<_T2>::value))>::type* <anonymous> = 0]' at /OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot/usr/include/gtest/gtest.h:1398:64,
    inlined from 'virtual void TestSequence_sequence_overflow_Test::TestBody()' at /OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/git/test/test_corners.cpp:374:9:
/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/recipe-sysroot/usr/include/gtest/gtest.h:1379:11: error: 'x' may be used uninitialized [-Werror=maybe-uninitialized]
 1379 |   if (lhs == rhs) {
      |       ~~~~^~~~~~
/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/git/test/test_corners.cpp: In member function 'virtual void TestSequence_sequence_overflow_Test::TestBody()':
/OE/build/luneos-scarthgap/tmp-glibc/work/corei7-64-webos-linux/leveldb-tl/1.0.6+git/git/test/test_corners.cpp:372:23: note: 'x' was declared here
  372 |         unsigned char x;
      |                       ^
cc1plus: all warnings being treated as errors
---
Upstream-Status: Pending

 test/test_corners.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/test/test_corners.cpp b/test/test_corners.cpp
index fe7d08a..28d17fd 100644
--- a/test/test_corners.cpp
+++ b/test/test_corners.cpp
@@ -369,7 +369,7 @@ TEST(TestSequence, sequence_overflow)
     leveldb::Sequence<unsigned char> seq {db, "x"};
     for(size_t n = 0; n < 0x100; ++n)
     {
-        unsigned char x;
+        unsigned char x = 0;
         ASSERT_OK( seq.Next(x) );
         EXPECT_EQ( n, x );
     }
